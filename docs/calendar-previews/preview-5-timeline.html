<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Preview 5: Day Timeline + Lanes</title>
    <style>
      :root{
        --bg0:#0b1020;
        --bg1:#0c1226;
        --ink:#f4f7ff;
        --muted:#b9c3e0;
        --stroke:rgba(255,255,255,.12);
        --shadow: 0 20px 60px rgba(0,0,0,.45);
        --r: 18px;
      }
      *{box-sizing:border-box}
      body{
        margin:0;
        background:
          radial-gradient(1200px 760px at 20% 10%, rgba(59,130,246,.16), transparent 60%),
          radial-gradient(1100px 760px at 84% 18%, rgba(244,63,94,.12), transparent 62%),
          linear-gradient(180deg, var(--bg0), var(--bg1));
        color:var(--ink);
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      }
      .wrap{max-width:1100px;margin:0 auto;padding:16px 14px 24px}
      .top{display:flex;align-items:flex-end;justify-content:space-between;gap:12px;flex-wrap:wrap;margin-bottom:12px}
      h1{margin:0;font-size:18px;letter-spacing:-.02em}
      .sub{color:var(--muted);font-size:12px}

      .panel{
        border:1px solid var(--stroke);
        background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.05));
        border-radius:var(--r);
        box-shadow:var(--shadow);
        overflow:hidden;
      }
      .ph{
        padding:12px 12px 10px;
        border-bottom:1px solid rgba(255,255,255,.08);
        background:rgba(255,255,255,.04);
        display:flex;align-items:baseline;justify-content:space-between;gap:10px;
      }
      .ph b{letter-spacing:-.01em}
      .ph span{color:var(--muted);font-size:12px}

      .timeline{
        display:grid;
        grid-template-columns: 70px 1fr;
        min-height:360px;
      }
      .hours{
        border-right:1px solid rgba(255,255,255,.08);
        padding:10px 0;
        background:rgba(255,255,255,.03);
      }
      .h{
        height:60px;
        padding:0 10px;
        display:flex;align-items:flex-start;justify-content:flex-end;
        font-size:11px;color:rgba(255,255,255,.58);
      }
      .laneWrap{
        position:relative;
        padding:10px 12px;
        background:
          repeating-linear-gradient(
            to bottom,
            rgba(255,255,255,.06) 0px,
            rgba(255,255,255,.06) 1px,
            transparent 1px,
            transparent 60px
          );
      }
      .event{
        position:absolute;
        left:0;
        width:calc(50% - 8px);
        border:1px solid rgba(255,255,255,.14);
        border-radius:16px;
        padding:10px 12px;
        background:rgba(255,255,255,.08);
        overflow:hidden;
      }
      .event.l2{left:calc(50% + 8px)}
      .event b{display:block;font-size:13px;letter-spacing:-.01em;line-height:1.2}
      .event span{display:block;color:var(--muted);font-size:12px;margin-top:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
      .rail{
        position:absolute;left:0;top:0;bottom:0;width:10px;border-radius:16px 0 0 16px;
      }
      .inner{margin-left:8px}

      @media (max-width: 860px){
        .timeline{grid-template-columns: 1fr}
        .hours{display:none}
        .event,.event.l2{left:0;width:100%}
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="top">
        <div>
          <h1>Day Timeline + Lanes</h1>
          <div class="sub">Use this when time matters (overlaps, “what can I do tonight?”). Lanes prevent collisions.</div>
        </div>
        <div class="sub">Example day: Thu Feb 12 (lots of collisions around 4–7pm).</div>
      </div>

      <section class="panel">
        <div class="ph">
          <b>Thu Feb 12</b>
          <span>Two lanes; more lanes can be added if needed.</span>
        </div>
        <div class="timeline">
          <div class="hours" id="hours"></div>
          <div class="laneWrap" id="lane"></div>
        </div>
      </section>
    </div>

    <script type="module">
      import { CAT, byDay, hhmmToMinutes } from './shared-data.js';
      const hours = document.getElementById('hours');
      const lane = document.getElementById('lane');

      // 10:00 -> 22:00
      const startMin = 10 * 60;
      const endMin = 22 * 60;
      const total = endMin - startMin;
      const pxPerMin = 60 / 60; // 60px per hour

      for (let h=10; h<=22; h++){
        const el = document.createElement('div');
        el.className = 'h';
        const hh = (h % 12) || 12;
        const ap = h < 12 ? "AM" : "PM";
        el.textContent = `${hh} ${ap}`;
        hours.appendChild(el);
      }

      const evs = byDay("Thu").map(e => {
        const s = hhmmToMinutes(e.start);
        const top = (s - startMin) * pxPerMin;
        const height = Math.max(44, e.dur * pxPerMin);
        return { ...e, s, top, height, end: s + e.dur };
      }).filter(e => e.s >= startMin && e.end <= endMin);

      // naive lane assignment: lane 1 if it doesn't overlap last lane1 event, else lane 2
      let l1End = -1;
      evs.forEach(e => {
        const useLane2 = e.s < l1End;
        if (!useLane2) l1End = e.end;
        const el = document.createElement('div');
        el.className = 'event' + (useLane2 ? ' l2' : '');
        el.style.top = `${e.top}px`;
        el.style.height = `${e.height}px`;
        el.innerHTML = `
          <div class="rail" style="background:${CAT[e.cat].rail}"></div>
          <div class="inner">
            <b>${e.title}</b>
            <span>${e.start} • ${e.venue} • ${CAT[e.cat].name}</span>
          </div>
        `;
        lane.appendChild(el);
      });

      // Expand container height to fit the day range.
      lane.style.minHeight = `${total * pxPerMin + 20}px`;
    </script>
  </body>
</html>

