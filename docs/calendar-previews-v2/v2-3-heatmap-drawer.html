<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>v2-3 Heatmap + Drawer</title>
    <style>
      :root{
        --bg0:#080c18;--bg1:#0c1328;
        --ink:#f4f7ff;--muted:#b3bedc;
        --stroke:rgba(255,255,255,.12);
        --shadow:0 20px 60px rgba(0,0,0,.45);
        --r:18px;
      }
      *{box-sizing:border-box}
      body{
        margin:0;
        background:
          radial-gradient(1100px 760px at 18% 8%, rgba(245,158,11,.14), transparent 60%),
          radial-gradient(900px 640px at 82% 22%, rgba(124,58,237,.16), transparent 62%),
          linear-gradient(180deg, var(--bg0), var(--bg1));
        color:var(--ink);
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      }
      .wrap{max-width:1100px;margin:0 auto;padding:16px 14px 24px}
      .top{display:flex;align-items:flex-end;justify-content:space-between;gap:12px;flex-wrap:wrap;margin-bottom:12px}
      h1{margin:0;font-size:18px;letter-spacing:-.02em}
      .sub{color:var(--muted);font-size:12px;max-width:70ch;line-height:1.45}

      .layout{display:grid;grid-template-columns: 1.1fr .9fr;gap:12px}
      .panel{
        border:1px solid var(--stroke);
        background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.05));
        border-radius:var(--r);
        box-shadow:var(--shadow);
        overflow:hidden;
      }
      .ph{padding:12px;border-bottom:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.04)}
      .ph b{letter-spacing:-.01em}
      .ph span{display:block;color:var(--muted);font-size:12px;margin-top:3px}

      .heat{
        padding:12px;
        display:grid;
        grid-template-columns: repeat(7, minmax(0, 1fr));
        gap:8px;
      }
      .dow{font-size:11px;color:rgba(255,255,255,.55);text-transform:uppercase;letter-spacing:.12em;padding:0 2px}
      .cell{
        border:1px solid rgba(255,255,255,.10);
        border-radius:14px;
        padding:10px 10px;
        min-height:78px;
        cursor:pointer;
        position:relative;
        background:rgba(255,255,255,.04);
      }
      .cell:hover{filter:brightness(1.06)}
      .cell[data-on="1"]{outline:2px solid rgba(142,227,255,.55)}
      .num{font-weight:850;letter-spacing:-.02em}
      .count{margin-top:6px;font-size:12px;color:rgba(255,255,255,.75)}

      .drawer{padding:12px;display:grid;gap:8px}
      .row{
        border:1px solid rgba(255,255,255,.10);
        background:rgba(255,255,255,.06);
        border-radius:16px;
        padding:10px 12px;
        display:flex;gap:10px;align-items:flex-start;
      }
      .rail{width:10px;border-radius:999px;flex:0 0 auto;height:44px;margin-top:2px}
      .row b{display:block;font-size:13px;letter-spacing:-.01em}
      .row span{display:block;color:var(--muted);font-size:12px;margin-top:2px}
      .empty{color:rgba(255,255,255,.55);font-size:12px;padding:10px 2px}

      @media (max-width: 980px){ .layout{grid-template-columns:1fr} }
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="top">
        <div>
          <h1>Density Heatmap + Drawer</h1>
          <div class="sub">Instead of a cramped week view, show “where the action is” with density. Clicking a day opens the event drawer.</div>
        </div>
        <div class="sub">This works great for: festivals, art openings, weekends.</div>
      </div>

      <div class="layout">
        <section class="panel">
          <div class="ph">
            <b>Week Density</b>
            <span>More events = brighter cell. Click any day.</span>
          </div>
          <div class="heat" id="heat"></div>
        </section>

        <section class="panel">
          <div class="ph">
            <b id="sel">Feb 12</b>
            <span id="cnt">0 events</span>
          </div>
          <div class="drawer" id="drawer"></div>
        </section>
      </div>
    </div>

    <script src="./shared-data.js"></script>
    <script>
      const { CAT, WEEK, byDay } = window.CalendarPreviewDataV2;
      const heat = document.getElementById('heat');
      const drawer = document.getElementById('drawer');
      const sel = document.getElementById('sel');
      const cnt = document.getElementById('cnt');

      function tintFor(n){
        const t = Math.min(1, n / 6);
        const a = 0.10 + t * 0.28;
        return `rgba(142,227,255,${a.toFixed(2)})`;
      }

      let selected = "Thu";

      function renderDrawer(dayKey){
        const w = WEEK.find(x => x.k === dayKey);
        const evs = byDay(dayKey);
        sel.textContent = `${dayKey} Feb ${w ? w.d : ""}`;
        cnt.textContent = `${evs.length} events`;
        drawer.innerHTML = "";
        if (!evs.length){
          const e = document.createElement('div');
          e.className = 'empty';
          e.textContent = 'No events';
          drawer.appendChild(e);
          return;
        }
        evs.forEach(ev => {
          const r = document.createElement('div');
          r.className = 'row';
          r.innerHTML = `
            <div class="rail" style="background:${CAT[ev.cat].rail}"></div>
            <div style="min-width:0">
              <b>${ev.title}</b>
              <span>${ev.start} • ${ev.venue} • ${CAT[ev.cat].name} • ${Math.round(ev.score)}/10</span>
            </div>
          `;
          drawer.appendChild(r);
        });
      }

      // header row
      WEEK.forEach(d => {
        const el = document.createElement('div');
        el.className = 'dow';
        el.textContent = d.k;
        heat.appendChild(el);
      });

      // just show our sample week as 7 cells
      WEEK.forEach(d => {
        const evs = byDay(d.k);
        const cell = document.createElement('div');
        cell.className = 'cell';
        cell.dataset.on = (d.k === selected) ? "1" : "0";
        cell.style.background = tintFor(evs.length);
        cell.innerHTML = `<div class="num">${d.d}</div><div class="count">${evs.length} events</div>`;
        cell.onclick = () => {
          selected = d.k;
          [...heat.querySelectorAll('.cell')].forEach(n => n.dataset.on = "0");
          cell.dataset.on = "1";
          renderDrawer(d.k);
        };
        heat.appendChild(cell);
      });

      renderDrawer(selected);
    </script>
  </body>
</html>

